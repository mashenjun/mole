---
raw:
  - tidb_tikvclient_gc_config
  - tikv_engine_size_bytes
  - tikv_store_size_bytes
  - tikv_raftstore_region_count
  - tikv_engine_num_files_at_level
  # - tikv_engine_pending_compaction_bytes # not used
  - tikv_engine_estimate_num_keys
  # - tikv_engine_num_files_at_level:kv:avg # not used
  # - tikv_engine_num_files_at_level:raft:avg # not used
cooked:
  - record: tikv_engine_size_bytes:avg_type
    expr: 'avg(tikv_engine_size_bytes)by(type)'
  - record: tikv_engine_size_bytes:per_instance
    expr: 'avg(sum(tikv_engine_size_bytes)by(instance))'
  - record: tikv_store_size_bytes:avg_type
    expr: 'avg(tikv_store_size_bytes)by(type)'
  - record: tikv_raftstore_region_count:avg_type
    expr: 'avg(tikv_raftstore_region_count)by(type)'
  - record: tikv_engine_pending_compaction_bytes:sum_db_instance
    expr: 'sum(tikv_engine_pending_compaction_bytes)by(db,instance)'
  - record: tikv_engine_size_bytes:avg_db_type
    expr: 'avg(tikv_engine_size_bytes)by(db,type)'
  - record: tikv_engine_size_bytes:sum_instance
    expr: 'sum(tikv_engine_size_bytes)by(instance)'
  - record: tikv_engine_num_files_at_level:avg_instance:default
    expr: 'avg(tikv_engine_num_files_at_level{db="kv",cf="default"})by(instance)'
  - record: tikv_engine_num_files_at_level:avg_level_instance:default_write
    expr: 'sum(tikv_engine_num_files_at_level{db="kv",cf=~"default|write"})by(level,instance)'
  - record: tikv_engine_key_size:per_instance:kv_default
    expr: 'sum(tikv_engine_size_bytes{db="kv",type="default"})by(instance)/sum(tikv_engine_estimate_num_keys{cf="default",db="kv"})by(instance)'
  - record: tikv_engine_key_size:per_instance:kv_write
    expr: 'sum(tikv_engine_size_bytes{db="kv",type="write"})by(instance)/sum(tikv_engine_estimate_num_keys{cf="write",db="kv"})by(instance)'